@startuml "MCP-Connector-Fix-Workflow"
' Diagram popisující workflow řešení problému s chybějícím atributem mcp_connector

skinparam monochrome true
skinparam shadowing false
skinparam defaultFontName "Arial"
skinparam defaultFontSize 12
skinparam activity {
  BorderColor Black
  BackgroundColor White
  ArrowColor Black
}

title MCP Connector Fix Workflow

start

:Identifikace problému|
note right: AttributeError: 'State' object has no attribute 'mcp_connector'

:Analýza příčiny|
note right
  LangGraph Platform nepropaguje metody
  třídy State správně do runtime prostředí
end note

:Úprava třídy State|
note right
  Přidání přímého atributu mcp_connector
  s anotací Annotated[Any, merge_dict_values]
end note

:Úprava metody get_mcp_connector()|
note right
  Kontrola existence atributu mcp_connector
  a vytvoření nové instance v případě potřeby
end note

:Úprava uzlů grafu, které používají MCP connector|
note right
  retrieve_company_data()
  retrieve_additional_company_data()
  retrieve_person_data()
end note

:Implementace fallback logiky|
note right
  Vytvoření nové instance MockMCPConnector
  když state.mcp_connector ani state.get_mcp_connector() nejsou dostupné
end note

:Propagace mcp_connector přes návratové hodnoty|
note right
  Každý uzel vrací "mcp_connector" jako součást stavu
  pro zajištění dostupnosti v následujících uzlech
end note

:Nasazení na LangGraph Platform|
note right
  Použití deploy_to_github.sh pro push
  čistého kódu na GitHub
end note

:Verifikace řešení|
note right
  Kontrola logů, jestli chyba zmizela
end note

stop
@enduml
