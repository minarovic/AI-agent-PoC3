@startuml "State-MCP-Connector-Fix-Workflow"
title Workflow opravy problému s mcp_connector atributem

start
:Identifikace chyby v GitHub Actions;
note right: AttributeError("'State' object has no attribute 'mcp_connector'")

:Analýza definice State třídy;
note right: Třída má mcp_connector_config a get_mcp_connector(), ne mcp_connector

:Vyhledání problematických míst v kódu;
note right: grep_search "state.mcp_connector"

:Identifikace vzorů problémového kódu;
note right
Vzor 1: Přímá kontrola
if not state.mcp_connector:
    state.mcp_connector = MockMCPConnector()

Vzor 2: Přímé použití
data = state.mcp_connector.get_company_by_name()
end note

:Návrh opravy;
note right
1. Odstranit kontroly a inicializace
2. Použít state.get_mcp_connector() místo state.mcp_connector
end note

fork
  :Oprava sekcí přímého použití;
  note right: company_data = state.get_mcp_connector().get_company_by_name()
fork again
  :Oprava vícenásobného použití;
  note right
  mcp_connector = state.get_mcp_connector()
  financial_data = mcp_connector.get_company_financials()
  relationships = mcp_connector.get_company_relationships()
  end note
end fork

:Testování opravy;
note right: verify_deployment.sh, test_standalone.py

:Dokumentace změn;
note right: Aktualizace notes.md a vytvoření state_mcp_connector_fix.md

:Nasazení na GitHub;
note right: ./deploy_to_github.sh

stop
@enduml
